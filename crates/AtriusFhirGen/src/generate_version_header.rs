use atrius_fhir_lib::fhir_version::FhirVersion;
use std::path::PathBuf;
/// Generates a comprehensive module documentation header for a FHIR version.
///
/// This function creates module-level documentation that describes the FHIR
/// specification version, its contents, usage examples, feature flags, and license.
///
/// # Arguments
///
/// * `version` - The FHIR version to generate documentation for
///
/// # Returns
///
/// A string containing the complete module header with:
/// - Module-level documentation
/// - License and attribution information
/// - Lint configuration attributes
/// - Standard use statements
pub fn generate_version_header(version: &FhirVersion) -> String {
    let (version_num, release_date, spec_url, status) = match version {
        #[cfg(feature = "R4")]
        FhirVersion::R4 => (
            "4.0.1".to_string(),
            "October 30, 2019".to_string(),
            "http://hl7.org/fhir/R4/",
            "normative+trial-use",
        ),
        #[cfg(feature = "R4B")]
        FhirVersion::R4B => (
            "4.3.0".to_string(),
            "May 28, 2022".to_string(),
            "http://hl7.org/fhir/R4B/",
            "trial-use",
        ),
        #[cfg(feature = "R5")]
        FhirVersion::R5 => (
            "5.0.0".to_string(),
            "March 26, 2023".to_string(),
            "http://hl7.org/fhir/R5/",
            "trial-use",
        ),
        #[cfg(feature = "R6")]
        FhirVersion::R6 => {
            // For R6, read the download metadata to get the actual download date
            let resources_dir = PathBuf::from(env!("CARGO_MANIFEST_DIR")).join("resources/R6");
            let metadata_path = resources_dir.join("download_metadata.json");

            let download_date = if metadata_path.exists() {
                if let Ok(metadata_content) = std::fs::read_to_string(&metadata_path) {
                    if let Ok(metadata) =
                        serde_json::from_str::<serde_json::Value>(&metadata_content)
                    {
                        // Parse the Unix timestamp and format it nicely
                        if let Some(timestamp) = metadata["download_timestamp"].as_u64() {
                            let datetime = chrono::DateTime::from_timestamp(timestamp as i64, 0)
                                .unwrap_or_else(chrono::Utc::now);
                            datetime.format("%B %-d, %Y").to_string()
                        } else {
                            "date unknown".to_string()
                        }
                    } else {
                        "date unknown".to_string()
                    }
                } else {
                    "date unknown".to_string()
                }
            } else {
                "date unknown".to_string()
            };

            (
                "current".to_string(),
                download_date,
                "http://build.fhir.org/",
                "draft",
            )
        }
    };

    format!(
        "//! FHIR {} ({}) - generated type definitions
//!
//! This module contains generated Rust types for the HL7® FHIR® {}
//! ({}) specification. All types in this module are generated from the
//! official HL7 FHIR StructureDefinitions and provide comprehensive type-safe
//! access to FHIR resources, data types, and elements.
//!
//! # FHIR Version
//!
//! - **Version**: {}
//! - **Release Date**: {}
//! - **Status**: {}
//! - **Specification**: <{}>
//!
//! # Contents
//!
//! This module includes:
//!
//! - **Resources**: All FHIR resource types (Patient, Observation, Bundle, etc.)
//! - **Data Types**: Complex and primitive FHIR data types
//! - **Choice Types**: Enums for polymorphic elements (e.g., value[x])
//! - **Resource Enum**: A unified `Resource` enum containing all resource types
//!
//! # Code Generation
//!
//! This file is generated using the `helios-fhir-gen` code generator.
//! Do not edit this file manually - changes will be overwritten on regeneration.
//!
//! To regenerate this file:
//! ```bash
//! cargo build -p helios-fhir-gen --features {}
//! ./target/debug/fhir_gen {}
//! ```
//!
//! # Examples
//!
//! ## Parsing a FHIR resource from JSON
//!
//! ```rust
//! # #[cfg(feature = \"{}\")]
//! # {{
//! # fn main() -> Result<(), Box<dyn std::error::Error>> {{
//! use helios_fhir::{}::Patient;
//!
//! let json = r#\"{{
//!     \"resourceType\": \"Patient\",
//!     \"id\": \"example\",
//!     \"name\": [{{
//!         \"family\": \"Smith\",
//!         \"given\": [\"John\"]
//!     }}]
//! }}\"#;
//!
//! let patient: Patient = serde_json::from_str(json)?;
//! assert_eq!(patient.id.as_ref().unwrap().value.as_ref().unwrap(), \"example\");
//! # Ok(())
//! # }}
//! # }}
//! ```
//!
//! ## Serializing a FHIR resource to JSON
//!
//! ```rust
//! # #[cfg(feature = \"{}\")]
//! # {{
//! # fn main() -> Result<(), Box<dyn std::error::Error>> {{
//! use helios_fhir::{}::{{Patient, HumanName}};
//!
//! let patient = Patient {{
//!     id: None,
//!     name: Some(vec![HumanName {{
//!         family: Some(\"Doe\".to_string().into()),
//!         ..Default::default()
//!     }}]),
//!     ..Default::default()
//! }};
//!
//! let json = serde_json::to_string_pretty(&patient)?;
//! # Ok(())
//! # }}
//! # }}
//! ```
//!
//! ## Working with the Resource enum
//!
//! ```rust
//! # #[cfg(feature = \"{}\")]
//! # {{
//! use helios_fhir::{}::{{Resource, Patient}};
//!
//! let patient = Patient::default();
//! let resource = Resource::Patient(patient);
//!
//! // Pattern matching on resource type
//! match resource {{
//!     Resource::Patient(p) => println!(\"Found a patient\"),
//!     Resource::Observation(o) => println!(\"Found an observation\"),
//!     _ => println!(\"Other resource type\"),
//! }}
//! # }}
//! ```
//!
//! # Feature Flags
//!
//! This module is only available when the `{}` feature is enabled:
//!
//! ```toml
//! [dependencies]
//! helios-fhir = {{ version = \"*\", features = [\"{}\"] }}
//! ```
//!
//! # License
//!
//! This code is generated from the HL7® FHIR® standard specifications.
//! FHIR® is a registered trademark of Health Level Seven International (HL7).
//!
//! The FHIR specification is released under Creative Commons CC0 (\"No Rights Reserved\").
//! For full license details, see: <https://hl7.org/fhir/license.html>
//!
//! # Documentation Notes
//!
//! Generated documentation may contain content from HL7 FHIR specifications
//! which may include HTML-like tags and bracket notations that are not actual
//! HTML or links. Rustdoc warnings for these are suppressed below.

// Generated documentation contains content from HL7 FHIR specifications
// which may include HTML-like tags and bracket notations that are not actual HTML or links
#![allow(rustdoc::broken_intra_doc_links)]
#![allow(rustdoc::invalid_html_tags)]


use serde::{{Deserialize, Serialize}};
use atrius_macros::{{FhirPath, FhirSerde}};
use crate::precise_decimal::{{ DecimalElement}};
use crate::element::Element;
use crate::date_time::{{PrecisionTime, PrecisionDateTime, PrecisionDate, PrecisionInstant}};
use crate::fhir_version::FhirComplexTypeProvider;

",
        version.as_str(),
        version_num,
        version.as_str(),
        version_num,
        version_num,
        release_date,
        status,
        spec_url,
        version.as_str(),
        version.as_str(),
        version.as_str(),
        version.as_str().to_lowercase(),
        version.as_str(),
        version.as_str().to_lowercase(),
        version.as_str(),
        version.as_str().to_lowercase(),
        version.as_str(),
        version.as_str(),
    )
}
